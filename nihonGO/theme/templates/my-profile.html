{% extends 'components/wrapper.html' %}

{% block content %}
<div class="container mx-auto p-4">
    <!-- Greeting Section -->
    <div class="greeting-section mb-6">
        <h1 class="text-5xl text-crimson font-bold mb-4">こにちは, {{ user.username }}!</h1>
    </div>

    <!-- Personal Information Section -->
    <div class="profile-section mb-6">
        <h2 class="text-3xl font-bold mb-2">Personal Information</h2>

        <!-- Collapsible Section for Personal Information -->
        <div id="personal-info">
            <div class="bg-gray-100 p-4 rounded-md">
                <img src="{{ user.theme_profile.avatar.url }}" alt="Profile Picture" class="w-24 h-24 rounded-full mb-4">
                <p><strong>Username:</strong> {{ user.username }}</p>
                <p><strong>Email:</strong> {{ user.email }}</p>
                <p><strong>Bio:</strong> {{ user.theme_profile.bio }}</p>
                <a href="{% url 'edit-profile' %}" class="font-medium text-crimson hover:underline">Edit Profile</a>
            </div>
        </div>
    </div>

    <!-- Flashcards Section -->
    <div class="flashcards-section mb-6">
        <h2 class="text-3xl font-bold mb-2">My Progress</h2>

        <button class="w-full text-left bg-gray-200 py-2 px-4 rounded-md mb-2 focus:outline-none" data-toggle="collapse" data-target="#flashcard-progress" aria-expanded="false">
            View Flashcard Statistics
        </button>
        <div id="flashcard-progress" class="collapse">
            <div class="bg-gray-100 p-4 rounded-md">
                <p><strong>Total Cards Studied:</strong> {{ flashcard_progress.count }}</p>
                <p><strong>Progress:</strong> {{ flashcard_progress.progress_percentage }}%</p>
            </div>
        </div>
    </div>

    <!-- Forum Posts Section -->
    <div class="posts-section mb-6">
        <h2 class="text-3xl font-bold mb-2">My Posts</h2>

        <button class="w-full text-left bg-gray-200 py-2 px-4 rounded-md mb-2 focus:outline-none" data-toggle="collapse" data-target="#forum-posts" aria-expanded="false">
            View Your Forum Posts
        </button>
        <div id="forum-posts" class="collapse">
            <div class="bg-gray-100 p-4 rounded-md">
                <div><p><strong>Total Posts:</strong> {{ forum_posts|length }}</p></div>
                <div><p><strong>Total Upvotes:</strong> {{ total_upvotes }}</p></div>
                
                <!-- Loop through posts -->
                <div class="space-y-4 mt-4">
                    {% for post in forum_posts %}
                        <div class="post bg-white border border-gray-300 rounded-md shadow-md p-4 overflow-hidden">
                            <h3 class="font-semibold text-xl mb-2">{{ post.title }}</h3>
                            <p class="text-gray-600 mb-2">{{ post.content|truncatewords:30 }}</p>
                            <div class="overflow-y-auto max-h-48">
                                <a href="{% url 'post_detail' post.id %}" class="text-crimson hover:underline">View Full Post</a>
                            </div>
                        </div>
                    {% empty %}
                        <p>You have no forum posts yet.</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for Collapsing Sections -->
<script>
    document.querySelectorAll('[data-toggle="collapse"]').forEach(button => {
        button.addEventListener('click', function () {
            const target = document.querySelector(button.getAttribute('data-target'));
            target.classList.toggle('collapse');
        });
    });
</script>
{% endblock %}